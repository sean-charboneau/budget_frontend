extends layout

block extraHeader
	script(type="text/javascript" src="/js/register.js")

block content
	div.container
		div.row
			div.col-sm-6.col-md-4.col-md-offset-4
				h1.text-center.login-title Registration Details
					div.signup-wall
						form.form-signin(data-bind='submit: register')
							input.form-control(type='text', data-bind='value: username', name='username', placeholder='Username', required, autofocus)
							input.form-control.nomargin(type='password', data-bind='value: password', name='password', placeholder='Password', required)
							input.form-control(type='email', data-bind='value: email', name='email', placeholder='Email', required)
							input.form-control(type='text', data-bind='value: firstName', name='firstName', placeholder='First Name', required)
							input.form-control(type='text', data-bind='value: lastName', name='lastName', placeholder='Last Name', required)
							select.form-control.currency-dropdown(required)
								option
							button(class='btn btn-lg btn-primary btn-block', type='submit') Register
							span.clearfix
					#message
					h1.text-center.error-message(id='error-message') #{message}

	script.
		var vm = new RegisterViewModel();
		var currencies = !{currency};
		vm.currencies = ko.observableArray(currencies);

		$(document).ready(function() {
			ko.applyBindings(vm);
			var formatOption = function(item) {
				if (!item.icon) { return item.display_name; }
				var $item = $(
					'<span><img src="images/flags/16/' + item.icon + '.png" class="img-flag" /> ' + item.display_name + '</span>'
				);
				return $item;
			}
			$('.currency-dropdown').select2({
				data: vm.currencies(),
				matcher: function(params, data) {
					var term = $.trim(params.term);
					if (term === '') {
						return data;
					}
					if(data.id === '') {
						return null;
					}
					if(data.display_name.toUpperCase().indexOf(term.toUpperCase()) > -1) {
						return data;
					}
					return null;
				},
				placeholder: {
					id: '',
					display_name: 'Home Currency',
					icon: '_unknown'
				},
				templateResult: formatOption,
				templateSelection: formatOption,
				theme: 'bootstrap'
			});
			$('.select2-selection').css('height', 'auto');
		});